ysahloul@DESKTOP-5IKV0D5:~$ curl -X POST http://localhost:8787/api/functions \\
  -H "Content-Type: application/json" \
  -d '{
    "type": "tool-calls",
    "call": {
      "id": "call_789"
    },
    "toolCallList": [
      {
        "id": "call_789",
        "type": "function",
        "function": {
          "name": "createOrder",
          "arguments": "{\"items\": [{\"catalogObjectId\": \"23QTUPAIWA2OVHYEYJGSGCQO\", \"quantity\": \"1\"}]}"
        }
      }
    ]
  }'
{"results":[{"toolCallId":"call_789","result":"{\"success\":true,\"orderId\":\"EV3PBkgaQTHe54673QSaD4PwzCEZY\",\"items\":[{\"name\":\"QUESABIRRIA\",\"quantity\":\"1\",\"price\":\"$13.98\"}],\"totalAmount\":\"$13.98\",\"paymentStatus\":\"Payment creation failed\"}"}]}


Received request body: {
  "type": "tool-calls",
  "call": {
    "id": "call_789"
  },
  "toolCallList": [
    {
      "id": "call_789",
      "type": "function",
      "function": {
        "name": "createOrder",
        "arguments": "{\"items\": [{\"catalogObjectId\": \"23QTUPAIWA2OVHYEYJGSGCQO\", \"quantity\": \"1\"}]}"
      }
    }
  ]
}
Processing tool calls
Handling tool calls: {
  "type": "tool-calls",
  "call": {
    "id": "call_789"
  },
  "toolCallList": [
    {
      "id": "call_789",
      "type": "function",
      "function": {
        "name": "createOrder",
        "arguments": "{\"items\": [{\"catalogObjectId\": \"23QTUPAIWA2OVHYEYJGSGCQO\", \"quantity\": \"1\"}]}"
      }
    }
  ]
}
createOrder function called with args: {"items": [{"catalogObjectId": "23QTUPAIWA2OVHYEYJGSGCQO", "quantity": "1"}]}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Runtime.consoleAPICalled',
  params: {
    type: 'log',
    args: [ [Object], [Object] ],
    executionContextId: 117168225,
    timestamp: 1729201253250,
    stackTrace: { callFrames: [Array] }
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Runtime.consoleAPICalled',
  params: {
    type: 'log',
    args: [ [Object] ],
    executionContextId: 117168225,
    timestamp: 1729201253250,
    stackTrace: { callFrames: [Array] }
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Runtime.consoleAPICalled',
  params: {
    type: 'log',
    args: [ [Object], [Object] ],
    executionContextId: 117168225,
    timestamp: 1729201253250,
    stackTrace: { callFrames: [Array] }
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Runtime.consoleAPICalled',
  params: {
    type: 'log',
    args: [ [Object], [Object] ],
    executionContextId: 117168225,
    timestamp: 1729201253250,
    stackTrace: { callFrames: [Array] }
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Runtime.consoleAPICalled',
  params: {
    type: 'log',
    args: [ [Object], [Object] ],
    executionContextId: 117168225,
    timestamp: 1729201253259,
    stackTrace: { callFrames: [Array] }
  }
}
Parsed items: [ { catalogObjectId: '23QTUPAIWA2OVHYEYJGSGCQO', quantity: '1' } ]
Calling Square API to create order
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Runtime.consoleAPICalled',
  params: {
    type: 'log',
    args: [ [Object] ],
    executionContextId: 117168225,
    timestamp: 1729201253265,
    stackTrace: { callFrames: [Array] }
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Network.requestWillBeSent',
  params: {
    requestId: '0',
    loaderId: '',
    request: {
      url: 'https://connect.squareupsandbox.com/v2/orders',
      method: 'POST',
      headers: [Object],
      mixedContentType: 'blockable',
      initialPriority: 'VeryLow',
      referrerPolicy: 'unsafe-url',
      isLinkPreload: false
    },
    timestamp: 80659.332,
    wallTime: 1729201253.287,
    initiator: { type: 'script', stack: [Object], lineNumber: 0 },
    type: 'Fetch'
  }
}
[InspectorProxyWorker] SEND TO RUNTIME {"method":"Runtime.getIsolateId","id":100000448}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE { id: 100000448, result: { id: 'c7491dd3b15eb70c' } }
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Network.responseReceived',
  params: {
    requestId: '0',
    timestamp: 80660.079,
    type: 'XHR',
    response: {
      status: 200,
      statusText: 'OK',
      headers: [Object],
      mimeType: 'application/json',
      connectionReused: false,
      connectionId: 0,
      remotePort: 0,
      fromDiskCache: false,
      fromServiceWorker: false,
      encodedDataLength: 0,
      protocol: 'http/1.1',
      securityState: 'unknown'
    }
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Network.dataReceived',
  params: {
    requestId: '0',
    timestamp: 80660.08,
    dataLength: 539,
    encodedDataLength: 539
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Network.dataReceived',
  params: {
    requestId: '0',
    timestamp: 80660.08,
    dataLength: 922,
    encodedDataLength: 922
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Network.loadingFinished',
  params: {
    requestId: '0',
    timestamp: 80660.08,
    encodedDataLength: 1461,
    cfResponse: {
      body: 'eyJvcmRlciI6IHsiaWQiOiAiRVYzUEJrZ2FRVEhlNTQ2NzNRU2FENFB3ekNFWlkiLCJsb2NhdGlvbl9pZCI6ICJMWjFUQUdBSFBUR0dCIiwibGluZV9pdGVtcyI6IFt7InVpZCI6ICJ5ZHVFVFdkSWtLbU5NWVZTQVQxa2MiLCJjYXRhbG9nX29iamVjdF9pZCI6ICIyM1FUVVBBSVdBMk9WSFlFWUpHU0dDUU8iLCJjYXRhbG9nX3ZlcnNpb24iOiAxNzI5MTA5ODMyMzc1LCJxdWFudGl0eSI6ICIxIiwibmFtZSI6ICJRVUVTQUJJUlJJQSIsInZhcmlhdGlvbl9uYW1lIjogIlJlZ3VsYXIiLCJiYXNlX3ByaWNlX21vbmV5IjogeyJhbW91bnQiOiAxMzk4LCJjdXJyZW5jeSI6ICJVU0QifSwiZ3Jvc3Nfc2FsZXNfbW9uZXkiOiB7ImFtb3VudCI6IDEzOTgsImN1cnJlbmN5IjogIlVTRCJ9LCJ0b3RhbF90YXhfbW9uZXkiOiB7ImFtb3VudCI6IDAsImN1cnJlbmN5IjogIlVTRCJ9LCJ0b3RhbF9kaXNjb3VudF9tb25leSI6IHsiYW1vdW50IjogMCwiY3VycmVuY3kiOiAiVVNEIn0sInRvdGFsX21vbmV5IjogeyJhbW91bnQiOiAxMzk4LCJjdXJyZW5jeSI6ICJVU0QifSwidmFyaWF0aW9uX3RvdGFsX3ByaWNlX21vbmV5IjogeyJhbW91bnQiOiAxMzk4LCJjdXJyZW5jeSI6ICJVU0QifSwiaXRlbV90eXBlIjogIklURU0iLCJ0b3RhbF9zZXJ2aWNlX2NoYXJnZV9tb25leSI6IHsiYW1vdW50IjogMCwiY3VycmVuY3kiOiAiVVNEIn19XSwiY3JlYXRlZF9hdCI6ICIyMDI0LTEwLTE3VDIxOjQwOjUzLjY0M1oiLCJ1cGRhdGVkX2F0IjogIjIwMjQtMTAtMTdUMjE6NDA6NTMuNjQzWiIsInN0YXRlIjogIk9QRU4iLCJ2ZXJzaW9uIjogMSwidG90YWxfdGF4X21vbmV5IjogeyJhbW91bnQiOiAwLCJjdXJyZW5jeSI6ICJVU0QifSwidG90YWxfZGlzY291bnRfbW9uZXkiOiB7ImFtb3VudCI6IDAsImN1cnJlbmN5IjogIlVTRCJ9LCJ0b3RhbF90aXBfbW9uZXkiOiB7ImFtb3VudCI6IDAsImN1cnJlbmN5IjogIlVTRCJ9LCJ0b3RhbF9tb25leSI6IHsiYW1vdW50IjogMTM5OCwiY3VycmVuY3kiOiAiVVNEIn0sInRvdGFsX3NlcnZpY2VfY2hhcmdlX21vbmV5IjogeyJhbW91bnQiOiAwLCJjdXJyZW5jeSI6ICJVU0QifSwibmV0X2Ftb3VudHMiOiB7InRvdGFsX21vbmV5IjogeyJhbW91bnQiOiAxMzk4LCJjdXJyZW5jeSI6ICJVU0QifSwidGF4X21vbmV5IjogeyJhbW91bnQiOiAwLCJjdXJyZW5jeSI6ICJVU0QifSwiZGlzY291bnRfbW9uZXkiOiB7ImFtb3VudCI6IDAsImN1cnJlbmN5IjogIlVTRCJ9LCJ0aXBfbW9uZXkiOiB7ImFtb3VudCI6IDAsImN1cnJlbmN5IjogIlVTRCJ9LCJzZXJ2aWNlX2NoYXJnZV9tb25leSI6IHsiYW1vdW50IjogMCwiY3VycmVuY3kiOiAiVVNEIn19LCJzb3VyY2UiOiB7Im5hbWUiOiAiU2FuZGJveCBmb3Igc3EwaWRwLV9PX3lrWF9lMXRmVHhDM0dBaWVVS0EifSwibmV0X2Ftb3VudF9kdWVfbW9uZXkiOiB7ImFtb3VudCI6IDEzOTgsImN1cnJlbmN5IjogIlVTRCJ9fX0K',
      base64Encoded: true
    }
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Runtime.consoleAPICalled',
  params: {
    type: 'log',
    args: [ [Object] ],
    executionContextId: 117168225,
    timestamp: 1729201254048,
    stackTrace: { callFrames: [Array] }
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Runtime.consoleAPICalled',
  params: {
    type: 'log',
    args: [ [Object], [Object] ],
    executionContextId: 117168225,
    timestamp: 1729201254048,
    stackTrace: { callFrames: [Array] }
  }
}
Square API response: {
  "body": "{\"order\": {\"id\": \"EV3PBkgaQTHe54673QSaD4PwzCEZY\",\"location_id\": \"LZ1TAGAHPTGGB\",\"line_items\": [{\"uid\": \"yduETWdIkKmNMYVSAT1kc\",\"catalog_object_id\": \"23QTUPAIWA2OVHYEYJGSGCQO\",\"catalog_version\": 1729109832375,\"quantity\": \"1\",\"name\": \"QUESABIRRIA\",\"variation_name\": \"Regular\",\"base_price_money\": {\"amount\": 1398,\"currency\": \"USD\"},\"gross_sales_money\": {\"amount\": 1398,\"currency\": \"USD\"},\"total_tax_money\": {\"amount\": 0,\"currency\": \"USD\"},\"total_discount_money\": {\"amount\": 0,\"currency\": \"USD\"},\"total_money\": {\"amount\": 1398,\"currency\": \"USD\"},\"variation_total_price_money\": {\"amount\": 1398,\"currency\": \"USD\"},\"item_type\": \"ITEM\",\"total_service_charge_money\": {\"amount\": 0,\"currency\": \"USD\"}}],\"created_at\": \"2024-10-17T21:40:53.643Z\",\"updated_at\": \"2024-10-17T21:40:53.643Z\",\"state\": \"OPEN\",\"version\": 1,\"total_tax_money\": {\"amount\": 0,\"currency\": \"USD\"},\"total_discount_money\": {\"amount\": 0,\"currency\": \"USD\"},\"total_tip_money\": {\"amount\": 0,\"currency\": \"USD\"},\"total_money\": {\"amount\": 1398,\"currency\": \"USD\"},\"total_service_charge_money\": {\"amount\": 0,\"currency\": \"USD\"},\"net_amounts\": {\"total_money\": {\"amount\": 1398,\"currency\": \"USD\"},\"tax_money\": {\"amount\": 0,\"currency\": \"USD\"},\"discount_money\": {\"amount\": 0,\"currency\": \"USD\"},\"tip_money\": {\"amount\": 0,\"currency\": \"USD\"},\"service_charge_money\": {\"amount\": 0,\"currency\": \"USD\"}},\"source\": {\"name\": \"Sandbox for sq0idp-_O_ykX_e1tfTxC3GAieUKA\"},\"net_amount_due_money\": {\"amount\": 1398,\"currency\": \"USD\"}}}\n",
  "headers": {
    "[object object]": "undefined"
  },
  "statusCode": 200,
  "request": {
    "method": "POST",
    "url": "https://connect.squareupsandbox.com/v2/orders",
    "headers": {
      "Content-Type": "application/json",
      "authorization": "Bearer EAAAl_QWIINfCcwgwAHnUGKvlJSXG5VY6dzS4Wtb0Ez5YJzLHW9J6XINgJ4V7LK0",
      "user-agent": "Square-TypeScript-SDK/38.1.0 (2024-09-19) {engine}/{engine-version} ({os-info}) ",
      "Square-Version": "2024-09-19"
    },
    "body": {
      "type": "text",
      "content": "{\"order\":{\"location_id\":\"LZ1TAGAHPTGGB\",\"line_items\":[{\"quantity\":\"1\",\"catalog_object_id\":\"23QTUPAIWA2OVHYEYJGSGCQO\"}]}}"
    }
  },
  "result": {
    "order": {
      "id": "EV3PBkgaQTHe54673QSaD4PwzCEZY",
      "locationId": "LZ1TAGAHPTGGB",
      "source": {
        "name": "Sandbox for sq0idp-_O_ykX_e1tfTxC3GAieUKA"
      },
      "lineItems": [
        {
          "uid": "yduETWdIkKmNMYVSAT1kc",
          "name": "QUESABIRRIA",
          "quantity": "1",
          "catalogObjectId": "23QTUPAIWA2OVHYEYJGSGCQO",
          "catalogVersion": "1729109832375",
          "variationName": "Regular",
          "itemType": "ITEM",
          "basePriceMoney": {
            "amount": "1398",
            "currency": "USD"
          },
          "variationTotalPriceMoney": {
            "amount": "1398",
            "currency": "USD"
          },
          "grossSalesMoney": {
            "amount": "1398",
            "currency": "USD"
          },
          "totalTaxMoney": {
            "amount": "0",
            "currency": "USD"
          },
          "totalDiscountMoney": {
            "amount": "0",
            "currency": "USD"
          },
          "totalMoney": {
            "amount": "1398",
            "currency": "USD"
          },
          "totalServiceChargeMoney": {
            "amount": "0",
            "currency": "USD"
          }
        }
      ],
      "netAmounts": {
        "totalMoney": {
          "amount": "1398",
          "currency": "USD"
        },
        "taxMoney": {
          "amount": "0",
          "currency": "USD"
        },
        "discountMoney": {
          "amount": "0",
          "currency": "USD"
        },
        "tipMoney": {
          "amount": "0",
          "currency": "USD"
        },
        "serviceChargeMoney": {
          "amount": "0",
          "currency": "USD"
        }
      },
      "createdAt": "2024-10-17T21:40:53.643Z",
      "updatedAt": "2024-10-17T21:40:53.643Z",
      "state": "OPEN",
      "version": 1,
      "totalMoney": {
        "amount": "1398",
        "currency": "USD"
      },
      "totalTaxMoney": {
        "amount": "0",
        "currency": "USD"
      },
      "totalDiscountMoney": {
        "amount": "0",
        "currency": "USD"
      },
      "totalTipMoney": {
        "amount": "0",
        "currency": "USD"
      },
      "totalServiceChargeMoney": {
        "amount": "0",
        "currency": "USD"
      },
      "netAmountDueMoney": {
        "amount": "1398",
        "currency": "USD"
      }
    }
  }
}
Creating payment for order
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Network.requestWillBeSent',
  params: {
    requestId: '1',
    loaderId: '',
    request: {
      url: 'https://connect.squareupsandbox.com/v2/payments',
      method: 'POST',
      headers: [Object],
      mixedContentType: 'blockable',
      initialPriority: 'VeryLow',
      referrerPolicy: 'unsafe-url',
      isLinkPreload: false
    },
    timestamp: 80660.133,
    wallTime: 1729201254.087,
    initiator: { type: 'script', stack: [Object], lineNumber: 0 },
    type: 'Fetch'
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Network.responseReceived',
  params: {
    requestId: '1',
    timestamp: 80660.761,
    type: 'XHR',
    response: {
      status: 400,
      statusText: 'Bad Request',
      headers: [Object],
      mimeType: 'application/json',
      connectionReused: false,
      connectionId: 0,
      remotePort: 0,
      fromDiskCache: false,
      fromServiceWorker: false,
      encodedDataLength: 0,
      protocol: 'http/1.1',
      securityState: 'unknown'
    }
  }
}
[InspectorProxyWorker] RUNTIME INCOMING MESSAGE {
  method: 'Network.dataReceived',
  params: {
    requestId: '1',
    timestamp: 80660.761,
    dataLength: 156,
    encodedDataLength: 156
  }
}
✘ [ERROR] Error creating payment: ApiError: Response status code was not ok: 400.

      at null.<anonymous>
  (file:///home/ysahloul/vapi-cloud/node_modules/.pnpm/@apimatic+core@0.10.15/node_modules/@apimatic/core/es/http/requestBuilder.js:404:15)
      at DefaultRequestBuilder2.<anonymous>
  (file:///home/ysahloul/vapi-cloud/node_modules/.pnpm/@apimatic+core@0.10.15/node_modules/@apimatic/core/es/http/requestBuilder.js:197:40)
      at step
  (file:///home/ysahloul/vapi-cloud/node_modules/.pnpm/tslib@2.8.0/node_modules/tslib/tslib.es6.mjs:147:21)
      at Object.next
  (file:///home/ysahloul/vapi-cloud/node_modules/.pnpm/tslib@2.8.0/node_modules/tslib/tslib.es6.mjs:128:51)
      at fulfilled
  (file:///home/ysahloul/vapi-cloud/node_modules/.pnpm/tslib@2.8.0/node_modules/tslib/tslib.es6.mjs:118:56)
  {
    request: {
      method: 'POST',
      url: 'https://connect.squareupsandbox.com/v2/payments',
      headers: {
        'Content-Type': 'application/json',
        authorization: 'Bearer
  EAAAl_QWIINfCcwgwAHnUGKvlJSXG5VY6dzS4Wtb0Ez5YJzLHW9J6XINgJ4V7LK0',
        'user-agent': 'Square-TypeScript-SDK/38.1.0 (2024-09-19)
  {engine}/{engine-version} ({os-info}) ',
        'Square-Version': '2024-09-19'
      },
      body: {
        type: 'text',
        content:
  '{"source_id":"EXTERNAL","idempotency_key":"2024-10-17T21:40:54.059Z","amount_money":{"amount":1398,"currency":"USD"},"order_id":"EV3PBkgaQTHe54673QSaD4PwzCEZY","location_id":"LZ1TAGAHPTGGB"}'
      }
    },
    statusCode: 400,
    headers: { '[object object]': 'undefined' },
    body: '{"errors": [{"code": "BAD_REQUEST","detail": "EXTERNAL source requires
  external_details","field": "external_details","category": "INVALID_REQUEST_ERROR"}]}\n',
    result: [Object: null prototype] { errors: [ [Object: null prototype] ] },
    errors: [
      [Object: null prototype] {
        code: 'BAD_REQUEST',
        detail: 'EXTERNAL source requires external_details',
        field: 'external_details',
        category: 'INVALID_REQUEST_ERROR'
      }
    ]
  }
  Payment creation failed: Response status code was not ok: 400.


Payment result: {
  "success": false,
  "error": "Response status code was not ok: 400."
}
Formatted response: {
  "success": true,
  "orderId": "EV3PBkgaQTHe54673QSaD4PwzCEZY",
  "items": [
    {
      "name": "QUESABIRRIA",
      "quantity": "1",
      "price": "$13.98"
    }
  ],
  "totalAmount": "$13.98",
  "paymentStatus": "Payment creation failed"
}
Tool calls result: {
  "results": [
    {
      "toolCallId": "call_789",
      "result": "{\"success\":true,\"orderId\":\"EV3PBkgaQTHe54673QSaD4PwzCEZY\",\"items\":[{\"name\":\"QUESABIRRIA\",\"quantity\":\"1\",\"price\":\"$13.98\"}],\"totalAmount\":\"$13.98\",\"paymentStatus\":\"Payment creation failed\"}"
    }
  ]
}